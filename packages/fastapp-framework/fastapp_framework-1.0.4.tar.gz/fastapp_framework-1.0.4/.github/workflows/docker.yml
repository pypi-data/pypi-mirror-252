name: Docker Compose Actions Workflow
on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'

jobs:
  docker-build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Build Docker Images
        run: |
          docker-compose build

      - name: Tag Docker Images
        run: |
          docker tag fastapp:local ${{ secrets.DOCKER_USERNAME }}/fastapp:${{ github.ref_name }}
          docker tag fastapp-nginx:local ${{ secrets.DOCKER_USERNAME }}/fastapp-nginx:${{ github.ref_name }}
          docker tag fastapp:local ${{ secrets.DOCKER_USERNAME }}/fastapp:latest
          docker tag fastapp-nginx:local ${{ secrets.DOCKER_USERNAME }}/fastapp-nginx:latest

      - name: Login to Docker Hub
        run: |
          docker login -u="${{ secrets.DOCKER_USERNAME }}" -p="${{ secrets.DOCKER_PASSWORD }}"

      - name: Push to Docker Hub
        run: |
          docker push ${{ secrets.DOCKER_USERNAME }}/fastapp:${{ github.ref_name }}
          docker push ${{ secrets.DOCKER_USERNAME }}/fastapp-nginx:${{ github.ref_name }}
          docker push ${{ secrets.DOCKER_USERNAME }}/fastapp:latest
          docker push ${{ secrets.DOCKER_USERNAME }}/fastapp-nginx:latest