[project]
name = "corvic-engine"
requires-python = ">=3.8"
classifiers = [
  "Environment :: Console",
  "License :: Other/Proprietary License",
  "Programming Language :: Python :: Implementation :: CPython",
  "Programming Language :: Python :: Implementation :: PyPy",
  "Programming Language :: Rust",
  "Topic :: Scientific/Engineering",
]
dynamic = ["version"]
license = { file = "LICENSE" }
authors = [
  { name = "Corvic Team", email = "flock@corvic.ai" },
]
version = "0.1.0"

# TODO(ddn): Pull dependencies from tool.poetry.dependencies. We use maturin as
# the build system but poetry for the development environment.
#
# https://github.com/python-poetry/poetry/issues/3332
dependencies = [
  "polars >= 0.20",
]

[build-system]
requires = ["maturin>=1.4,<2.0"]
build-backend = "maturin"

[tool.poetry]
name = "corvic-engine"
packages = [
  { include = "corvic", from = "python" },
]
description = ""
authors = []
version = "0.1.0"

[tool.poetry.scripts]
check = "corvic_check.cli:main"

[tool.poetry.dependencies]
python = ">=3.11,<3.12"
polars = "^0.20.5"

[tool.poetry.group.dev.dependencies]
pyright = "^1.1.345"
pytest = "^7.4.2"
ruff = "^0.1.5"
maturin = "^1.4.0"
codespell = "^2.2.6"
click = "^8.1.7"

[tool.poetry.group.docs.dependencies]
sphinx-autodoc-typehints = "^1.25.2"
sphinx-rtd-theme = "^2.0.0"
sphinx = "^7.2.6"
pydata-sphinx-theme = "^0.15.2"

[tool.poetry.group.check-license]
optional = true

[tool.poetry.group.check-license.dependencies]
pip-licenses = "^4.3.3"

[tool.maturin]
module-name = "corvic.engine._native"
python-source = "python"
features = ["pyo3/extension-module"]
manifest-path = "python/Cargo.toml"

[tool.ruff]
force-exclude = true
line-length = 88
target-version = "py311"
src = ["python"]

[tool.ruff.lint]
select = [
  "B",
  "C4",
  "COM",
  "D",
  "DTZ",
  "E",
  "ERA",
  "EXE",
  "F",
  "FA",
  "FIX",
  "G",
  "I",
  "ICN",
  "INP",
  "ISC002",
  "N",
  "NPY",
  "PD",
  "PERF",
  "PIE",
  "PL",
  "PT",
  "PTH",
  "PYI",
  "Q",
  "RSE",
  "RUF",
  "SIM",
  "SLF",
  "SLOT",
  "T10",
  "T20",
  "TD",
  "TID",
  "TRY",
  "UP",
  "W",
  "YTT",
]

ignore = [
  # Conflicts with ruff format
  "COM812",
  # Having issue link with TODO is not necessary
  "TD003",
  # Allow TODO to exist
  "FIX002",
  # Do not complain about raising exception without arguments
  "RSE102",
  # Allow non-trivial exception messages
  "TRY003",
  # Allow use of print
  "T201",
]

[tool.ruff.per-file-ignores]
"python/tests/**/*.py" = [
  # test functions, among other things, do not need docstrings
  "D103",
]

[tool.ruff.lint.pydocstyle]
convention = "google"

[tool.ruff.format]
docstring-code-format = true

[tool.ruff.pycodestyle]
max-doc-length = 88

[tool.ruff.flake8-tidy-imports]
ban-relative-imports = "all"

[tool.pyright]
typeCheckingMode = "strict"
# Enable additional checks beyond strict
reportCallInDefaultInitializer = "error"
# typing.overrides will be available in Python 3.12
# reportImplicitOverride	= "error"
reportImplicitStringConcatenation = "error"
reportImportCycles = "error"
reportPropertyTypeMismatch = "error"
reportShadowedImports = "error"
reportUninitializedInstanceVariable = "error"
reportUnnecessaryTypeIgnoreComment = "error"
# Disable some checks enabled by strict because we do not require typing
# everywhere
reportMissingParameterType = "none"
reportMissingTypeStubs = "none"

[tool.pytest.ini_options]
xfail_strict = true
# Tell tests where python files live
testpaths = [
  "python/tests",
]

[tool.codespell]
skip = "**/target/*,./docs/build/*"
