import{C as Y,_ as Z}from"./ChatRecprdsHeader-9JjX2P9Q.js";import{d as C,o as n,c as d,a as e,t as V,_ as I,r as o,b as J,h as R,e as k,f as s,u as U,i as P,w as K,g as $,j as A,k as B,F as ee,l as te,n as L,m as E,p as W,v as G,E as ae,q as le,s as j,x as se,y as oe}from"./index-AhVYV2OA.js";const ne={class:"chat-content"},ie={key:0,class:"word"},re=["src"],ce={class:"info"},de={class:"time"},ue=["innerHTML"],_e={key:1,class:"word-my"},he={class:"info"},ve={class:"time"},pe=["innerHTML"],me=["src"],fe=C({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(a){const v=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,i)=>(n(),d("div",ne,[a.is_sender?(n(),d("div",_e,[e("div",he,[e("p",ve,V(a.direction),1),e("div",{class:"info-content",innerHTML:v(a.content)},null,8,pe)]),e("img",{src:a.headUrl},null,8,me)])):(n(),d("div",ie,[e("img",{src:a.headUrl},null,8,re),e("div",ce,[e("p",de,V(a.direction),1),e("div",{class:"info-content",innerHTML:v(a.content)},null,8,ue)])]))]))}}),ye=I(fe,[["__scopeId","data-v-d930be9e"]]),ge={class:"chat-content"},we={key:0,class:"word"},xe=["src"],be={class:"info"},ke={class:"time"},$e={class:"demo-image__preview"},Se={key:1,class:"word-my"},Me={class:"info"},Te={class:"time"},Ue={class:"demo-image__preview"},De=["src"],Ve=C({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(a){const v=a,l=o("");J(async()=>{l.value=await i(v.src)});const i=async h=>{try{return await R.post("/api/img",{img_path:h})}catch(p){return console.error("Error fetching data:",p),""}};return(h,p)=>{const w=k("el-image");return n(),d("div",ge,[a.is_sender?(n(),d("div",Se,[e("div",Me,[e("p",Te,V(a.direction),1),e("div",Ue,[s(w,{style:{"max-width":"150px","max-height":"150px"},src:l.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[l.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:a.headUrl},null,8,De)])):(n(),d("div",we,[e("img",{src:a.headUrl},null,8,xe),e("div",be,[e("p",ke,V(a.direction),1),e("div",$e,[s(w,{style:{"max-width":"150px","max-height":"150px"},src:l.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[l.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),Ce=I(Ve,[["__scopeId","data-v-2190d708"]]),He={class:"chat-content"},je={key:0,class:"word"},Ee=["src"],Re={class:"info"},Ie={class:"time"},qe={controls:"",style:{"background-color":"#fff"}},Ae=["src"],Be={key:1,class:"word-my"},Le={class:"info"},Ne={class:"time"},Fe={controls:"",style:{"background-color":"#95EC69"}},Oe=["src"],ze=["src"],Pe=C({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(a){return(v,l)=>(n(),d("div",He,[a.is_sender?(n(),d("div",Be,[e("div",Le,[e("p",Ne,V(a.direction),1),e("audio",Fe,[e("source",{src:a.src,type:"audio/wav"},null,8,Oe)]),s(U(P),{rows:1,readonly:!0,value:a.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:a.headUrl},null,8,ze)])):(n(),d("div",je,[e("img",{src:a.headUrl},null,8,Ee),e("div",Re,[e("p",Ie,V(a.direction),1),e("audio",qe,[e("source",{src:a.src,type:"audio/wav"},null,8,Ae)]),s(U(P),{rows:1,readonly:!0,value:a.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),We=I(Pe,[["__scopeId","data-v-0d0f2cd4"]]),Ge={id:"chat"},Je={class:"chat_body"},Ke={class:"chat_window",ref:"chatWindow"},Qe={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},Xe=C({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(a,{expose:v}){const l=a,i=o([]),h=o({}),p=o(""),w=o(50),u=o(0),y=o(!1),M=async(r,x,c)=>{try{const t=await R.post("/api/msgs",{start:r,limit:x,wxid:c});return i.value=t.msg_list,h.value=t.user_list,p.value=t.my_wxid,t}catch(t){return console.error("Error fetching data:",t),[]}},T=async()=>{try{u.value=l.userData.chat_count-w.value,await M(u.value,w.value,l.userData.username),y.value||await L(()=>{l.setScrollTop(),y.value=!1})}catch(r){return console.error("Error fetching data:",r),[]}};J(T),K(()=>l.userData.username,(r,x)=>{i.value=[],y.value=!1,T()});const f=r=>(r.talker=="我"&&(r.talker=p.value),`${(c=>h.value.hasOwnProperty(c.talker)?h.value[c.talker].remark?h.value[c.talker].remark:h.value[c.talker].nickname?h.value[c.talker].nickname:h.value[c.talker].account?h.value[c.talker].account:c.talker:c.talker)(r)} [${r.type_name}] ${r.CreateTime}`),S=r=>(r.talker=="我"&&(r.talker=p.value),h.value.hasOwnProperty(r.talker)?h.value[r.talker].headImgUrl:""),D=async()=>{let r=w.value,x=u.value-r;const c=await R.post("/api/msgs",{start:x,limit:r,wxid:l.userData.username});u.value=x,i.value=c.msg_list.concat(i.value),i.value.sort((t,g)=>t.id-g.id),i.value=i.value.filter((t,g,q)=>g===0||t.id!==q[g-1].id),h.value=Object.assign(h.value,c.user_list),await L(()=>{l.updateScrollTop()})};return v({loadMore:D}),(r,x)=>{const c=k("el-button");return n(),d("div",Ge,[e("div",Je,[e("div",Ke,[i.value.length<a.userData.chat_count?(n(),d("div",Qe,[s(c,{type:"primary",onClick:D},{default:$(()=>[A("查看更多消息")]),_:1})])):B("",!0),(n(!0),d(ee,null,te(i.value,(t,g)=>(n(),d("div",{class:"message",key:g},[t.type_name=="文本"?(n(),E(ye,{key:0,is_sender:t.is_sender,direction:f(t),headUrl:S(t),content:t.content.msg},null,8,["is_sender","direction","headUrl","content"])):t.type_name=="图片"?(n(),E(Ce,{key:1,is_sender:t.is_sender,direction:f(t),headUrl:S(t),src:t.content.src},null,8,["is_sender","direction","headUrl","src"])):t.type_name=="语音"?(n(),E(We,{key:2,is_sender:t.is_sender,direction:f(t),headUrl:S(t),src:"api/"+t.content.src,msg:t.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):B("",!0)]))),128))],512)])])}}}),Ye=I(Xe,[["__scopeId","data-v-978e4e80"]]),Ze=C({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(a){const v=o(null),l=o(null);o(0);const i=o(0),h=()=>{L(()=>{if(v.value){const u=v.value.$el.children[0];u&&(u.scrollTop=u.scrollHeight,i.value=u.scrollHeight)}})},p=()=>{const u=v.value.$el.children[0];if(u){const y=i.value,M=u.scrollHeight-y;u.scrollTop=u.scrollTop+M,i.value=u.scrollHeight}};function w({scrollTop:u}){u===0&&l.value&&l.value.loadMore()}return(u,y)=>{const M=k("el-header"),T=k("el-scrollbar"),f=k("el-main"),S=k("el-container");return n(),E(S,null,{default:$(()=>[s(M,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:$(()=>[s(Y,{userData:a.userData},null,8,["userData"])]),_:1}),s(f,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:$(()=>[s(T,{ref_key:"scrollbarRef",ref:v,onScroll:w},{default:$(()=>[s(Ye,{ref_key:"chatRecordsMainRef",ref:l,userData:a.userData,setScrollTop:h,updateScrollTop:p},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),et={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},tt={key:0},at={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},lt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),st={style:{"margin-top":"20px"}},ot={style:{"margin-top":"20px"}},nt={key:1},it={style:{"background-color":"#fff",width:"70%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},rt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),ct={style:{"margin-top":"20px"}},dt=e("label",null,"MicroMsg.db路径: ",-1),ut=e("br",null,null,-1),_t=e("label",null,"MSG.db路径: ",-1),ht=e("br",null,null,-1),vt=e("label",null,"MediaMSG.db路径: ",-1),pt=e("br",null,null,-1),mt=e("label",null,"微信文件夹路径: ",-1),ft=e("br",null,null,-1),yt=e("label",null,"微信原始id: ",-1),gt=e("br",null,null,-1),wt=e("label",null,"密钥key(可空): ",-1),xt=e("br",null,null,-1),bt={key:2,style:{display:"flex","justify-content":"space-between"}},kt={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},$t=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),St={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},Mt=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),Tt=C({__name:"IsAutoShow",emits:["isAutoShow"],setup(a,{emit:v}){const l=o(0),i=o(500),h=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],p=o(new Date().getTime()),w=()=>{S.value||(p.value=new Date().getTime(),!(l.value>=99)&&(l.value>=80&&(i.value=i.value+50),l.value=l.value+1,setTimeout(w,i.value)))},u=o(!1),y=o([]),M=o(""),T=o(!1),f=o(""),S=o(!1),D=o(""),r=o(""),x=o(""),c=o(""),t=o(""),g=o(""),q=v,Q=async()=>{try{y.value=await R.post("/api/wxinfo"),y.value.length===1&&(N(y.value[0]),M.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(F,5e3))}catch(b){return console.error("Error fetching data:",b),[]}},N=async b=>{D.value="",r.value="",x.value="",c.value=b.filePath,t.value=b.key,g.value=b.wxid},F=()=>{c.value===""&&t.value===""&&g.value===""||T.value||(console.log(c.value,t.value,g.value),T.value=!0,O(),w())},O=async()=>{try{let b={msg_path:D.value,micro_path:r.value,media_path:x.value,wx_path:c.value,key:t.value,my_wxid:g.value};const _=await R.post("/api/init",b);u.value=_.is_init,_.is_init&&(l.value=100),q("isAutoShow",_.is_init)}catch(b){return l.value=0,S.value=!0,ae.alert(b,"error",{confirmButtonText:"确认",callback:_=>{le({type:"error",message:`action: ${_}`})}}),[]}};return K(f,b=>{b==="auto"&&Q()}),(b,_)=>{const X=k("el-progress"),z=k("el-button"),H=k("el-input");return n(),d("div",et,[f.value==="auto"?(n(),d("div",tt,[T.value&&!S.value?(n(),E(X,{key:0,type:"dashboard",percentage:l.value,color:h},null,8,["percentage"])):(n(),d("div",at,[lt,e("div",st,[s(U(se),{data:y.value,onCurrentChange:N,"highlight-current-row":"",style:{width:"100%"}},{default:$(()=>[s(U(j),{"min-width":30,prop:"pid",label:"进程id"}),s(U(j),{"min-width":40,prop:"version",label:"微信版本"}),s(U(j),{"min-width":40,prop:"account",label:"账号"}),s(U(j),{"min-width":40,prop:"name",label:"昵称"}),s(U(j),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",ot,[s(z,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:F},{default:$(()=>[A("确定"+V(M.value),1)]),_:1})])]))])):f.value==="custom"?(n(),d("div",nt,[e("div",it,[rt,e("div",ct,[dt,s(H,{placeholder:"MicroMsg.db",modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=m=>r.value=m),style:{width:"50%"}},null,8,["modelValue"]),ut,_t,s(H,{placeholder:"MSG.db",modelValue:D.value,"onUpdate:modelValue":_[1]||(_[1]=m=>D.value=m),style:{width:"50%"}},null,8,["modelValue"]),ht,vt,s(H,{placeholder:"MediaMSG.db",modelValue:x.value,"onUpdate:modelValue":_[2]||(_[2]=m=>x.value=m),style:{width:"50%"}},null,8,["modelValue"]),pt,mt,s(H,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:c.value,"onUpdate:modelValue":_[3]||(_[3]=m=>c.value=m),style:{width:"50%"}},null,8,["modelValue"]),ft,yt,s(H,{placeholder:"wxid_*******",modelValue:g.value,"onUpdate:modelValue":_[4]||(_[4]=m=>g.value=m),style:{width:"50%"}},null,8,["modelValue"]),gt,wt,s(H,{placeholder:"密钥key【64位，可为空，空表示上诉数据库已解密】",modelValue:t.value,"onUpdate:modelValue":_[5]||(_[5]=m=>t.value=m),style:{width:"50%"}},null,8,["modelValue"]),xt,s(z,{style:{"margin-top":"10px",width:"50%"},type:"success",onClick:O},{default:$(()=>[A("确定")]),_:1})])])])):f.value===""?(n(),d("div",bt,[e("label",kt,[W(e("input",{type:"radio","onUpdate:modelValue":_[6]||(_[6]=m=>f.value=m),value:"auto"},null,512),[[G,f.value]]),$t]),e("label",St,[W(e("input",{type:"radio","onUpdate:modelValue":_[7]||(_[7]=m=>f.value=m),value:"custom"},null,512),[[G,f.value]]),Mt])])):B("",!0)])}}}),Ut={id:"chat_view",class:"common-layout"},Dt={key:0},Vt={key:1},Ct={key:0,style:{height:"calc(100vh)",width:"100%"}},Ht={key:1,style:{width:"100%",height:"100%"}},Rt=C({__name:"ChatView",setup(a){const v=o({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),l=p=>{v.value=p},i=o(!1),h=p=>{i.value=p};return(p,w)=>{const u=k("el-aside"),y=k("el-container");return n(),d("div",Ut,[i.value?(n(),d("div",Vt,[s(y,null,{default:$(()=>[s(u,{width:"266px",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:$(()=>[s(Z,{onUserData:l})]),_:1}),v.value.username!=""?(n(),d("div",Ct,[s(Ze,{userData:v.value},null,8,["userData"])])):(n(),d("div",Ht,[s(oe)]))]),_:1})])):(n(),d("div",Dt,[s(Tt,{onIsAutoShow:h})]))])}}});export{Rt as default};
