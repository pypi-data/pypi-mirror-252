import{C as X,_ as Y}from"./ChatRecprdsHeader-6ucLwsMd.js";import{d as C,o as s,c as d,a as e,t as V,_ as I,r as n,b as J,h as R,e as b,f as o,u as U,i as P,w as K,g as $,j as A,k as L,F as Z,l as ee,n as N,m as E,p as W,v as G,E as te,q as j,s as le,x as ae}from"./index-dHTaJain.js";const oe={class:"chat-content"},se={key:0,class:"word"},ne=["src"],ie={class:"info"},re={class:"time"},ce=["innerHTML"],de={key:1,class:"word-my"},ue={class:"info"},_e={class:"time"},he=["innerHTML"],ve=["src"],pe=C({__name:"MessageText",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""}},setup(a){const v=l=>(l=l.replace(/\n/g,"<br>"),new DOMParser().parseFromString(l,"text/html").body.innerHTML);return(l,i)=>(s(),d("div",oe,[a.is_sender?(s(),d("div",de,[e("div",ue,[e("p",_e,V(a.direction),1),e("div",{class:"info-content",innerHTML:v(a.content)},null,8,he)]),e("img",{src:a.headUrl},null,8,ve)])):(s(),d("div",se,[e("img",{src:a.headUrl},null,8,ne),e("div",ie,[e("p",re,V(a.direction),1),e("div",{class:"info-content",innerHTML:v(a.content)},null,8,ce)])]))]))}}),me=I(pe,[["__scopeId","data-v-d930be9e"]]),fe={class:"chat-content"},ye={key:0,class:"word"},ge=["src"],we={class:"info"},xe={class:"time"},be={class:"demo-image__preview"},ke={key:1,class:"word-my"},$e={class:"info"},Se={class:"time"},Me={class:"demo-image__preview"},Te=["src"],Ue=C({__name:"MessageImg",props:{is_sender:{type:Number,default:0},content:{type:String,default:""},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""}},setup(a){const v=a,l=n("");J(async()=>{l.value=await i(v.src)});const i=async _=>{try{return await R.post("/api/img",{img_path:_})}catch(p){return console.error("Error fetching data:",p),""}};return(_,p)=>{const x=b("el-image");return s(),d("div",fe,[a.is_sender?(s(),d("div",ke,[e("div",$e,[e("p",Se,V(a.direction),1),e("div",Me,[o(x,{style:{"max-width":"150px","max-height":"150px"},src:l.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[l.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])]),e("img",{src:a.headUrl},null,8,Te)])):(s(),d("div",ye,[e("img",{src:a.headUrl},null,8,ge),e("div",we,[e("p",xe,V(a.direction),1),e("div",be,[o(x,{style:{"max-width":"150px","max-height":"150px"},src:l.value,"zoom-rate":1.2,"max-scale":7,"min-scale":.2,"preview-src-list":[l.value],"initial-index":4,fit:"cover"},null,8,["src","preview-src-list"])])])]))])}}}),De=I(Ue,[["__scopeId","data-v-2190d708"]]),Ve={class:"chat-content"},Ce={key:0,class:"word"},He=["src"],je={class:"info"},Ee={class:"time"},Re={controls:"",style:{"background-color":"#fff"}},Ie=["src"],qe={key:1,class:"word-my"},Ae={class:"info"},Le={class:"time"},Ne={controls:"",style:{"background-color":"#95EC69"}},Fe=["src"],Oe=["src"],ze=C({__name:"MessageAudio",props:{is_sender:{type:Number,default:0},headUrl:{type:String,default:""},direction:{type:String,default:""},src:{type:String,default:""},msg:{type:String,default:""}},setup(a){return(v,l)=>(s(),d("div",Ve,[a.is_sender?(s(),d("div",qe,[e("div",Ae,[e("p",Le,V(a.direction),1),e("audio",Ne,[e("source",{src:a.src,type:"audio/wav"},null,8,Fe)]),o(U(P),{rows:1,readonly:!0,value:a.msg,style:{width:"100%"}},null,8,["value"])]),e("img",{src:a.headUrl},null,8,Oe)])):(s(),d("div",Ce,[e("img",{src:a.headUrl},null,8,He),e("div",je,[e("p",Ee,V(a.direction),1),e("audio",Re,[e("source",{src:a.src,type:"audio/wav"},null,8,Ie)]),o(U(P),{rows:1,readonly:!0,value:a.msg,style:{width:"100%"}},null,8,["value"])])]))]))}}),Be=I(ze,[["__scopeId","data-v-0d0f2cd4"]]),Pe={id:"chat"},We={class:"chat_body"},Ge={class:"chat_window",ref:"chatWindow"},Je={key:0,class:"load_more",style:{display:"flex","justify-content":"center","margin-top":"10px","margin-bottom":"10px"}},Ke=C({__name:"ChatRecordsMain",props:{userData:{type:Object,required:!0},setScrollTop:{type:Function,required:!0},updateScrollTop:{type:Function,required:!0}},setup(a,{expose:v}){const l=a,i=n([]),_=n({}),p=n(""),x=n(50),u=n(0),w=n(!1),S=async(r,y,c)=>{try{const t=await R.post("/api/msgs",{start:r,limit:y,wxid:c});return i.value=t.msg_list,_.value=t.user_list,p.value=t.my_wxid,t}catch(t){return console.error("Error fetching data:",t),[]}},M=async()=>{try{u.value=l.userData.chat_count-x.value,await S(u.value,x.value,l.userData.username),w.value||await N(()=>{l.setScrollTop(),w.value=!1})}catch(r){return console.error("Error fetching data:",r),[]}};J(M),K(()=>l.userData.username,(r,y)=>{i.value=[],w.value=!1,M()});const f=r=>(r.talker=="我"&&(r.talker=p.value),`${(c=>_.value.hasOwnProperty(c.talker)?_.value[c.talker].remark?_.value[c.talker].remark:_.value[c.talker].nickname?_.value[c.talker].nickname:_.value[c.talker].account?_.value[c.talker].account:c.talker:c.talker)(r)} [${r.type_name}] ${r.CreateTime}`),k=r=>(r.talker=="我"&&(r.talker=p.value),_.value.hasOwnProperty(r.talker)?_.value[r.talker].headImgUrl:""),D=async()=>{let r=x.value,y=u.value-r;const c=await R.post("/api/msgs",{start:y,limit:r,wxid:l.userData.username});u.value=y,i.value=c.msg_list.concat(i.value),i.value.sort((t,T)=>t.id-T.id),i.value=i.value.filter((t,T,q)=>T===0||t.id!==q[T-1].id),_.value=Object.assign(_.value,c.user_list),await N(()=>{l.updateScrollTop()})};return v({loadMore:D}),(r,y)=>{const c=b("el-button");return s(),d("div",Pe,[e("div",We,[e("div",Ge,[i.value.length<a.userData.chat_count?(s(),d("div",Je,[o(c,{type:"primary",onClick:D},{default:$(()=>[A("查看更多消息")]),_:1})])):L("",!0),(s(!0),d(Z,null,ee(i.value,(t,T)=>(s(),d("div",{class:"message",key:T},[t.type_name=="文本"?(s(),E(me,{key:0,is_sender:t.is_sender,direction:f(t),headUrl:k(t),content:t.content.msg},null,8,["is_sender","direction","headUrl","content"])):t.type_name=="图片"?(s(),E(De,{key:1,is_sender:t.is_sender,direction:f(t),headUrl:k(t),src:t.content.src},null,8,["is_sender","direction","headUrl","src"])):t.type_name=="语音"?(s(),E(Be,{key:2,is_sender:t.is_sender,direction:f(t),headUrl:k(t),src:"api/"+t.content.src,msg:t.content.msg},null,8,["is_sender","direction","headUrl","src","msg"])):L("",!0)]))),128))],512)])])}}}),Qe=I(Ke,[["__scopeId","data-v-978e4e80"]]),Xe=C({__name:"ChatRecords",props:{userData:{type:Object,required:!0}},setup(a){const v=n(null),l=n(null);n(0);const i=n(0),_=()=>{N(()=>{if(v.value){const u=v.value.$el.children[0];u&&(u.scrollTop=u.scrollHeight,i.value=u.scrollHeight)}})},p=()=>{const u=v.value.$el.children[0];if(u){const w=i.value,S=u.scrollHeight-w;u.scrollTop=u.scrollTop+S,i.value=u.scrollHeight}};function x({scrollTop:u}){u===0&&l.value&&l.value.loadMore()}return(u,w)=>{const S=b("el-header"),M=b("el-scrollbar"),f=b("el-main"),k=b("el-container");return s(),E(k,null,{default:$(()=>[o(S,{style:{height:"65px","max-height":"65px",width:"100%","background-color":"#d2d2fa","padding-top":"5px"}},{default:$(()=>[o(X,{userData:a.userData},null,8,["userData"])]),_:1}),o(f,{style:{"overflow-y":"auto",height:"calc(100vh - 65px)",padding:"0"}},{default:$(()=>[o(M,{ref_key:"scrollbarRef",ref:v,onScroll:x},{default:$(()=>[o(Qe,{ref_key:"chatRecordsMainRef",ref:l,userData:a.userData,setScrollTop:_,updateScrollTop:p},null,8,["userData"])]),_:1},512)]),_:1})]),_:1})}}}),Ye={style:{"background-color":"#d2d2fa",height:"100vh",display:"flex","justify-content":"center","align-items":"center"}},Ze={key:0},et={key:1,style:{"background-color":"#fff",width:"90%","min-width":"800px",height:"80%","border-radius":"10px",padding:"20px",overflow:"auto"}},tt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"选择要查看的微信")],-1),lt={style:{"margin-top":"20px"}},at={style:{"margin-top":"20px"}},ot={key:1},st={style:{"background-color":"#fff",width:"70%","min-width":"800px",height:"70%","border-radius":"10px",padding:"20px",overflow:"auto"}},nt=e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}},[e("div",{style:{"font-size":"20px","font-weight":"bold"}},"自定义-文件位置"),e("div",{style:{display:"flex","justify-content":"space-between","align-items":"center"}})],-1),it={style:{"margin-top":"20px"}},rt=e("label",null,"MicroMsg.db路径: ",-1),ct=e("br",null,null,-1),dt=e("label",null,"MSG.db路径: ",-1),ut=e("br",null,null,-1),_t=e("label",null,"MediaMSG.db路径: ",-1),ht=e("br",null,null,-1),vt=e("label",null,"微信文件夹路径: ",-1),pt=e("br",null,null,-1),mt=e("label",null,"微信原始id: ",-1),ft=e("br",null,null,-1),yt=e("label",null,"密钥key(可空): ",-1),gt=e("br",null,null,-1),wt={key:2,style:{display:"flex","justify-content":"space-between"}},xt={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px","margin-right":"20px"}},bt=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自动解密已登录微信")],-1),kt={style:{width:"200px",height:"150px","background-color":"#fff",display:"flex","flex-direction":"column","align-items":"center","border-radius":"10px"}},$t=e("div",{style:{display:"flex","flex-direction":"column","justify-content":"center","align-items":"center",height:"100%"}},[e("div",null,"自定义文件位置")],-1),St=C({__name:"IsAutoShow",emits:["isAutoShow"],setup(a,{emit:v}){const l=n(0),i=n(500),_=[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}],p=n(new Date().getTime()),x=()=>{console.log(l.value),console.log(i.value),console.log(p.value,new Date().getTime()-p.value),p.value=new Date().getTime(),!(l.value>=99)&&(l.value>=80&&(i.value=i.value+50),l.value=l.value+1,setTimeout(x,i.value))},u=n(!1),w=n([]),S=n(""),M=n(!1),f=n(""),k=n(""),D=n(""),r=n(""),y=n(""),c=n(""),t=n(""),T=v,q=async()=>{try{w.value=await R.post("/api/wxinfo"),w.value.length===1&&(F(w.value[0]),S.value=" (检测到只有一个微信，将在5秒后自动选择) ",setTimeout(O,5e3))}catch(g){return console.error("Error fetching data:",g),[]}},F=async g=>{k.value="",D.value="",r.value="",y.value=g.filePath,c.value=g.key,t.value=g.wxid},O=()=>{y.value===""&&c.value===""&&t.value===""||M.value||(console.log(y.value,c.value,t.value),M.value=!0,z(),x())},z=async()=>{try{let g={msg_path:k.value,micro_path:D.value,media_path:r.value,wx_path:y.value,key:c.value,my_wxid:t.value};console.log(g);const h=await R.post("/api/init",g);u.value=h.is_init,h.is_init&&(l.value=100),T("isAutoShow",h.is_init)}catch(g){return l.value=0,console.error("Error fetching data:",g),te.error(g),[]}};return K(f,g=>{g==="auto"&&q()}),(g,h)=>{const Q=b("el-progress"),B=b("el-button"),H=b("el-input");return s(),d("div",Ye,[f.value==="auto"?(s(),d("div",Ze,[M.value?(s(),E(Q,{key:0,"show-text":"加载中",type:"dashboard",percentage:l.value,color:_},null,8,["percentage"])):(s(),d("div",et,[tt,e("div",lt,[o(U(le),{data:w.value,onCurrentChange:F,"highlight-current-row":"",style:{width:"100%"}},{default:$(()=>[o(U(j),{"min-width":30,prop:"pid",label:"进程id"}),o(U(j),{"min-width":40,prop:"version",label:"微信版本"}),o(U(j),{"min-width":40,prop:"account",label:"账号"}),o(U(j),{"min-width":40,prop:"name",label:"昵称"}),o(U(j),{"min-width":50,prop:"wxid",label:"微信原始id"})]),_:1},8,["data"])]),e("div",at,[o(B,{style:{"margin-right":"10px","margin-top":"10px",width:"100%"},type:"success",onClick:O},{default:$(()=>[A("确定"+V(S.value),1)]),_:1})])]))])):f.value==="custom"?(s(),d("div",ot,[e("div",st,[nt,e("div",it,[rt,o(H,{placeholder:"MicroMsg.db",modelValue:D.value,"onUpdate:modelValue":h[0]||(h[0]=m=>D.value=m),style:{width:"50%"}},null,8,["modelValue"]),ct,dt,o(H,{placeholder:"MSG.db",modelValue:k.value,"onUpdate:modelValue":h[1]||(h[1]=m=>k.value=m),style:{width:"50%"}},null,8,["modelValue"]),ut,_t,o(H,{placeholder:"MediaMSG.db",modelValue:r.value,"onUpdate:modelValue":h[2]||(h[2]=m=>r.value=m),style:{width:"50%"}},null,8,["modelValue"]),ht,vt,o(H,{placeholder:"C:\\***\\WeChat Files\\wxid_*******",modelValue:y.value,"onUpdate:modelValue":h[3]||(h[3]=m=>y.value=m),style:{width:"50%"}},null,8,["modelValue"]),pt,mt,o(H,{placeholder:"wxid_*******",modelValue:t.value,"onUpdate:modelValue":h[4]||(h[4]=m=>t.value=m),style:{width:"50%"}},null,8,["modelValue"]),ft,yt,o(H,{placeholder:"密钥key【64位，可为空，空表示上诉数据库已解密】",modelValue:c.value,"onUpdate:modelValue":h[5]||(h[5]=m=>c.value=m),style:{width:"50%"}},null,8,["modelValue"]),gt,o(B,{style:{"margin-top":"10px",width:"50%"},type:"success",onClick:z},{default:$(()=>[A("确定")]),_:1})])])])):f.value===""?(s(),d("div",wt,[e("label",xt,[W(e("input",{type:"radio","onUpdate:modelValue":h[6]||(h[6]=m=>f.value=m),value:"auto"},null,512),[[G,f.value]]),bt]),e("label",kt,[W(e("input",{type:"radio","onUpdate:modelValue":h[7]||(h[7]=m=>f.value=m),value:"custom"},null,512),[[G,f.value]]),$t])])):L("",!0)])}}}),Mt={id:"chat_view",class:"common-layout"},Tt={key:0},Ut={key:1},Dt={key:0,style:{height:"calc(100vh)",width:"100%"}},Vt={key:1,style:{width:"100%",height:"100%"}},jt=C({__name:"ChatView",setup(a){const v=n({account:"",describe:"",headImgUrl:"",nickname:"",remark:"",username:"",chat_count:0}),l=p=>{v.value=p},i=n(!1),_=p=>{i.value=p};return(p,x)=>{const u=b("el-aside"),w=b("el-container");return s(),d("div",Mt,[i.value?(s(),d("div",Ut,[o(w,null,{default:$(()=>[o(u,{width:"266px",style:{"overflow-y":"auto",height:"calc(100vh)"}},{default:$(()=>[o(Y,{onUserData:l})]),_:1}),v.value.username!=""?(s(),d("div",Dt,[o(Xe,{userData:v.value},null,8,["userData"])])):(s(),d("div",Vt,[o(ae)]))]),_:1})])):(s(),d("div",Tt,[o(St,{onIsAutoShow:_})]))])}}});export{jt as default};
