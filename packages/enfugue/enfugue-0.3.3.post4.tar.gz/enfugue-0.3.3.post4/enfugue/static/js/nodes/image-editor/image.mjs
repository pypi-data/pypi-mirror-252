import{isEmpty,promptFiles}from"../../base/helpers.mjs";import{View}from"../../view/base.mjs";import{ImageView,BackgroundImageView}from"../../view/image.mjs";import{ImageEditorNodeView}from"./base.mjs";import{NoImageView}from"./common.mjs";class ImageEditorImageNodeView extends ImageEditorNodeView{static hideHeader=!0;static nodeTypeName="Image";static className="image-editor-image-node-view";static nodeButtons={...ImageEditorNodeView.nodeButtons,"replace-image":{icon:"fa-solid fa-upload",tooltip:"Replace Image",shortcut:"c",callback:function(){this.replaceImage()}},"mirror-x":{icon:"fa-solid fa-left-right",tooltip:"Mirror Horizontally",shortcut:"z",callback:function(){this.mirrorHorizontally()}},"mirror-y":{icon:"fa-solid fa-up-down",tooltip:"Mirror Vertically",shortcut:"y",callback:function(){this.mirrorVertically()}},"rotate-clockwise":{icon:"fa-solid fa-rotate-right",tooltip:"Rotate Clockwise",shortcut:"r",callback:function(){this.rotateClockwise()}},"rotate-counter-clockwise":{icon:"fa-solid fa-rotate-left",tooltip:"Rotate Counter-Clockwise",shortcut:"w",callback:function(){this.rotateCounterClockwise()}}};async updateOptions(t){this.updateFit(t.fit),this.updateAnchor(t.anchor,t.offsetX,t.offsetY),this.updateOpacity(t.opacity)}async updateFit(t){this.fit=t,this.content.setFit(t)}async updateAnchor(t,e,i){this.anchor=t,this.offsetX=isEmpty(e)?0:e,this.offsetY=isEmpty(i)?0:i,this.content.setAnchor(this.anchor,this.offsetX,this.offsetY)}async updateOpacity(t){this.opacity=t,(await this.content.getNode()).css("opacity",t)}async replaceImage(){let t;try{t=await promptFiles("image/*")}catch(t){}if(!isEmpty(t)){let e=new FileReader;e.addEventListener("load",(async()=>{let t=new BackgroundImageView(this.config,e.result,!1);await this.setContent(t),this.updateFit(this.fit),this.updateAnchor(this.anchor),this.updateOpacity(this.opacity)})),e.readAsDataURL(t)}this.contentChanged()}mirrorHorizontally(){this.content.mirrorHorizontally(),this.contentChanged()}mirrorVertically(){this.content.mirrorVertically(),this.contentChanged()}rotateClockwise(){this.content.rotateClockwise(),this.contentChanged()}rotateCounterClockwise(){this.content.rotateCounterClockwise(),this.contentChanged()}getState(t=!0){let e=super.getState(t);return e.src=t?this.content.src:null,e.anchor=this.anchor||null,e.offsetX=this.offsetX||null,e.offsetY=this.offsetY||null,e.fit=this.fit||null,e.opacity=this.opacity||null,e}async setState(t){await super.setState(t),isEmpty(t.src)?await this.setContent(new NoImageView(this.config)):await this.setContent(new BackgroundImageView(this.config,t.src,!1)),await this.updateFit(t.fit),await this.updateAnchor(t.anchor,t.offsetX,t.offsetY),await this.updateOpacity(t.opacity)}async getCanvasScaleSize(){return isEmpty(this.content.src)?await super.getCanvasScaleSize():(await this.content.waitForLoad(),[8*Math.floor(this.content.width/8),8*Math.floor(this.content.height/8)])}static getDefaultState(){return{classname:this.name}}}export{ImageEditorImageNodeView};
