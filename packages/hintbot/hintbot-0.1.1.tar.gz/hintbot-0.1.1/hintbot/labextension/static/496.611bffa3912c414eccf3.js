"use strict";(self.webpackChunkhintbot=self.webpackChunkhintbot||[]).push([[496],{496:(e,t,n)=>{n.r(t),n.d(t,{default:()=>v});var a=n(801),o=n(605),i=n(123),r=n(778),s=n(770),l=n(29),d=n.n(l);class c extends i.ReactWidget{constructor(e){super(),this._message="",this._message=e}getValue(){var e;return null===(e=this.node.querySelector("textarea"))||void 0===e?void 0:e.value}render(){return d().createElement("div",{className:"reflection"},d().createElement("label",null,this._message,d().createElement("textarea",{name:"reflection-input",className:"reflection-input",rows:10})))}}const u=e=>(0,i.showDialog)({title:"Reflection",body:new c(e),buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Submit"})],hasClose:!1});var m=n(108),g=n(737);const h=async(e,t,n,a)=>{var o;const r=null===(o=a.getMetadata("nbgrader"))||void 0===o?void 0:o.grade_id,s=a.getMetadata("remaining_hints");let l="HintRequested";if(document.getElementById("hint-banner"))l="HintAlreadyExists",(0,i.showDialog)({title:"Please review previous hint first",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]});else if(s<1)l="NotEnoughHint",(0,i.showDialog)({title:"No hint left",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]});else{const o=t.get("preReflection").composite,s=t.get("postReflection").composite;if((async(e,t,n,a)=>{var o;const r=n.getMetadata("nbgrader").grade_id,s=n.getMetadata("remaining_hints"),l=document.createElement("div");l.id="hint-banner-placeholder",e.content.node.insertBefore(l,e.content.node.firstChild);const d=document.createElement("div");d.id="hint-banner",null===(o=e.content.node.parentElement)||void 0===o||o.insertBefore(d,e.content.node),d.innerHTML='<p><span class="loader"></span>Retrieving hint... Please do not refresh the page.</p> <p>It usually takes around 2 minutes to generate a hint. You may continue to work on the assignment in the meantime</p>';try{const o={problem_id:r,buggy_notebook_path:e.context.path},c=await async function(e="",t={}){const n=g.ServerConnection.makeSettings(),a=m.URLExt.join(n.baseUrl,"hintbot",e);let o;try{o=await g.ServerConnection.makeRequest(a,t,n)}catch(e){throw new g.ServerConnection.NetworkError(e)}let i=await o.text();if(i.length>0)try{i=JSON.parse(i)}catch(e){console.log("Not a JSON response body.",o)}if(!o.ok)throw new g.ServerConnection.ResponseError(o,i.message||i);return i}("hint",{method:"POST",body:JSON.stringify(o)});if(c.job_finished&&c.feedback){const o=c.feedback;d.innerText=o,n.setMetadata("remaining_hints",s-1),document.getElementById(r).innerText=`Hint (${s-1} left)`,e.context.save();const i=document.createElement("div");i.id="hint-banner-buttons-container";const m=document.createElement("div");m.id="hint-banner-buttons";const g=document.createElement("button");g.classList.add("hint-banner-button"),g.innerText="Helpful ðŸ‘";const h=document.createElement("button");h.classList.add("hint-banner-button"),h.innerText="Unhelpful ðŸ‘Ž";const b=async n=>{if(t.exporters.forEach((a=>{t.publishEvent(e,{eventName:"HintEvaluated",eventTime:Date.now(),eventInfo:{gradeId:r,hintContent:o,evaluation:n}},a,!0)})),a){const n=await u("Write a brief statement of what you learned from the hint and how you will use it to solve the problem.");"Submit"===n.button.label&&(d.remove(),l.remove()),t.exporters.forEach((a=>{t.publishEvent(e,{eventName:"PostReflection",eventTime:Date.now(),eventInfo:{status:n.button.label,gradeId:r,reflection:n.value}},a,!1)}))}else d.remove(),l.remove()};g.onclick=()=>{b("helpful")},h.onclick=()=>{b("unhelpful")},m.appendChild(h),m.appendChild(g),i.appendChild(m),d.appendChild(i)}else d.remove(),l.remove(),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]})}catch(e){console.log(e),d.remove(),l.remove(),(0,i.showDialog)({title:"Hint Request Error. Please try again later",buttons:[i.Dialog.createButton({label:"Dismiss",className:"jp-Dialog-button jp-mod-reject jp-mod-styled"})]})}})(e,n,a,s),o){document.getElementById("hint-banner").style.filter="blur(10px)";const t=await u("Write a brief statement of what the problem is that you are facing and why you think your solution is not working.");document.getElementById("hint-banner").style.filter="none",n.exporters.forEach((a=>{n.publishEvent(e,{eventName:"PreReflection",eventTime:Date.now(),eventInfo:{status:t.button.label,gradeId:r,reflection:t.value}},a,!1)}))}}n.exporters.forEach((t=>{n.publishEvent(e,{eventName:"HintRequested",eventTime:Date.now(),eventInfo:{status:l,gradeId:r}},t,!1)}))},b={id:"hintbot:plugin",description:"A JupyterLab extension.",autoStart:!0,requires:[o.INotebookTracker,a.ISettingRegistry,s.IJupyterLabPioneer],activate:async(e,t,n,a)=>{const o=document.createElement("button");o.innerText="Activate HintBot Extension",o.id="hintbot-activation-button";const s=document.createElement("div");s.appendChild(o);const l=await n.load(b.id);t.widgetAdded.connect((async(e,t)=>{await t.revealed,await a.loadExporters(t),t.toolbar.insertAfter("spacer","hintbot-activation-button",new r.Widget({node:s})),o.onclick=async()=>{"Confirm activation"===(await(0,i.showDialog)({body:"The hintbot extension is a prototype and not required to be used for the course. \n The hints generated could be wrong, and it involves sending data to third party services outside of the university.",buttons:[i.Dialog.createButton({label:"Cancel"}),i.Dialog.createButton({label:"Confirm activation"})],hasClose:!1})).button.label&&(await(async(e,t,n)=>{var a,o,i,r;const s=t.get("hintQuantity").composite,l=null===(a=e.content.model)||void 0===a?void 0:a.cells;if(l&&e.model.getMetadata("etc_identifier")&&"7ca0093b-b622-4463-8696-65f1e0f33522"===e.model.getMetadata("etc_identifier"))for(let a=0;a<l.length;a++)if(l.get(a).getMetadata("nbgrader")&&"markdown"===(null===(o=l.get(a).getMetadata("nbgrader"))||void 0===o?void 0:o.cell_type)&&(null===(i=l.get(a).getMetadata("nbgrader"))||void 0===i?void 0:i.grade_id)&&"cell-018440eg2f1b6a62"!==(null===(r=l.get(a).getMetadata("nbgrader"))||void 0===r?void 0:r.grade_id)){const o=document.createElement("button");o.classList.add("hint-button"),o.id=l.get(a).getMetadata("nbgrader").grade_id,o.onclick=()=>h(e,t,n,l.get(a)),e.content.widgets[a].node.appendChild(o),void 0===l.get(a).getMetadata("remaining_hints")?(l.get(a).setMetadata("remaining_hints",s),o.innerText=`Hint (${s} left)`):o.innerText=`Hint (${l.get(a).getMetadata("remaining_hints")} left)`}})(t,l,a),o.remove(),a.exporters.forEach((e=>a.publishEvent(t,{eventName:"HintBotActivated",eventTime:new Date},e,!1))))}}))}},v=b}}]);