{% extends "../body.html" %}
{% load static %}
{% load util %}
{% block content %}
<script src="{% static 'js/settings/api_key.js' %}"></script>
<!--<input class="form-control me-2" type="search" placeholder="Search" aria-label="Search" id="aw-job-search">-->
{# todo: build table using ajax to allow dynamic search #}
<div class="table-responsive aw-data">
    <table class="table table-striped aw-text-responsive">
        <tr>
            <th>Job</th>
            <th>Inventory</th>
            <th>Playbook</th>
            <th>Comment</th>
            <th>Schedule</th>
            <th>Last run</th>
            <th>Next run</th>
            <th>Actions</th>
        </tr>
{%   if not jobs|exists %}
        <tr>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
            <td>-</td>
        </tr>
{%   endif %}
{%   for job in jobs %}
        <tr>
            <td>{{ job.name }}</td>
            <td>{{ job.inventory }}</td>
            <td>{{ job.playbook }}</td>
            <td>{{ job.comment|get_fallback:"-" }}</td>
            <td>{{ job.schedule|get_fallback:"-" }}</td>
            <td>{{ executions|get_value:job.id|last_execution_info|get_fallback:"-"|safe }}</td>
            <td>{{ next_executions|get_value:job.id }}</td>
            <td>
                <a href="/ui/jobs/manage/job/{{ job.id }}">
                    <button class="btn btn-warning aw-btn-action" title="Edit">
                        {% include "../button/icon/edit.html" %}
                    </button>
                </a>
                <button class="btn btn-danger aw-btn-action aw-api-click" title="Delete" aw-api-endpoint="job" aw-api-item="{{ job.id }}" aw-api-method="delete">
                    {% include "../button/icon/delete.html" %}
                </button>
                <button class="btn btn-primary aw-btn-action aw-api-click" title="Run" aw-api-endpoint="job" aw-api-item="{{ job.id }}" aw-api-method="post">
                    {% include "../button/icon/run.html" %}
                </button>
            </td>
        </tr>
{%   endfor %}
        <tr>
            <td colspan="100%">
                {% include "../button/refresh.html" %}
                {% include "../button/autoRefresh.html" %}
                <a href="/ui/jobs/manage/job">
                    <button class="btn btn-success aw-btn-action" title="Add">
                        {% include "../button/icon/add.html" %}
                    </button>
                </a>
                <a href="/ui/admin/">
                    <button class="btn btn-warning aw-btn-action" title="Admin">
                        <i class="fa fa-cog fa-2x aw-btn-action-icon" aria-hidden="true"></i>
                    </button>
                </a>
            </td>
        </tr>
    </table>
</div>
{% endblock %}