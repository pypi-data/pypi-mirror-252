import{r as m,w as Y,D as L,y as z,x as de,z as I,R as q,A as me,B as se,F as T,X as _,I as H,G as ie,H as pe,J as fe,K as U,M as xe,T as ve,Q as b,U as he,V as G,W as ge,Y as X,Z as le,$ as be,u as oe,a0 as $,a as E,a1 as ye,j as t,a2 as O,a3 as A,c as N,S as we,e as S,a4 as Ie,d as R,a5 as ce,m as Z,a6 as ee,a7 as K,a8 as Ee,a9 as je,E as Pe}from"./index-f823a46d.js";import{C as Re,I as te}from"./Input-7f1ddde5.js";import{F as Ne,E as j,P as ne}from"./PlanChangePreview-19b3533b.js";import{b as Se,u as ke,a as P,x as Me}from"./ListboxShow-966669dc.js";import{s as Ce,k as re}from"./popover-cf930454.js";import{M as De}from"./disclosure-6b2379df.js";import"./context-d40331ee.js";import"./_commonjs-dynamic-modules-302442b1.js";import"./ModelLineage-9be79e23.js";import"./SearchList-b6035f4b.js";import"./PlusIcon-ceeaae3b.js";function Fe({title:e,titleId:r,...a},s){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":r},a),e?m.createElement("title",{id:r},e):null,m.createElement("path",{fillRule:"evenodd",d:"M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z",clipRule:"evenodd"}))}const Ae=m.forwardRef(Fe),Te=Ae;function $e({title:e,titleId:r,...a},s){return m.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor","aria-hidden":"true",ref:s,"aria-labelledby":r},a),e?m.createElement("title",{id:r},e):null,m.createElement("path",{fillRule:"evenodd",d:"M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.007 5.404.433c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.433 2.082-5.006z",clipRule:"evenodd"}))}const Oe=m.forwardRef($e),Le=Oe;var ze=(e=>(e[e.Open=0]="Open",e[e.Closed=1]="Closed",e))(ze||{}),_e=(e=>(e[e.Pointer=0]="Pointer",e[e.Other=1]="Other",e))(_e||{}),Be=(e=>(e[e.OpenMenu=0]="OpenMenu",e[e.CloseMenu=1]="CloseMenu",e[e.GoToItem=2]="GoToItem",e[e.Search=3]="Search",e[e.ClearSearch=4]="ClearSearch",e[e.RegisterItem=5]="RegisterItem",e[e.UnregisterItem=6]="UnregisterItem",e))(Be||{});function V(e,r=a=>a){let a=e.activeItemIndex!==null?e.items[e.activeItemIndex]:null,s=be(r(e.items.slice()),u=>u.dataRef.current.domRef.current),i=a?s.indexOf(a):null;return i===-1&&(i=null),{items:s,activeItemIndex:i}}let Qe={1(e){return e.menuState===1?e:{...e,activeItemIndex:null,menuState:1}},0(e){return e.menuState===0?e:{...e,__demoMode:!1,menuState:0}},2:(e,r)=>{var a;let s=V(e),i=Me(r,{resolveItems:()=>s.items,resolveActiveIndex:()=>s.activeItemIndex,resolveId:u=>u.id,resolveDisabled:u=>u.dataRef.current.disabled});return{...e,...s,searchQuery:"",activeItemIndex:i,activationTrigger:(a=r.trigger)!=null?a:1}},3:(e,r)=>{let a=e.searchQuery!==""?0:1,s=e.searchQuery+r.value.toLowerCase(),i=(e.activeItemIndex!==null?e.items.slice(e.activeItemIndex+a).concat(e.items.slice(0,e.activeItemIndex+a)):e.items).find(o=>{var n;return((n=o.dataRef.current.textValue)==null?void 0:n.startsWith(s))&&!o.dataRef.current.disabled}),u=i?e.items.indexOf(i):-1;return u===-1||u===e.activeItemIndex?{...e,searchQuery:s}:{...e,searchQuery:s,activeItemIndex:u,activationTrigger:1}},4(e){return e.searchQuery===""?e:{...e,searchQuery:"",searchActiveItemIndex:null}},5:(e,r)=>{let a=V(e,s=>[...s,{id:r.id,dataRef:r.dataRef}]);return{...e,...a}},6:(e,r)=>{let a=V(e,s=>{let i=s.findIndex(u=>u.id===r.id);return i!==-1&&s.splice(i,1),s});return{...e,...a,activationTrigger:1}}},J=m.createContext(null);J.displayName="MenuContext";function B(e){let r=m.useContext(J);if(r===null){let a=new Error(`<${e} /> is missing a parent <Menu /> component.`);throw Error.captureStackTrace&&Error.captureStackTrace(a,B),a}return r}function Ue(e,r){return se(r.type,Qe,e,r)}let Ke=m.Fragment;function Ve(e,r){let{__demoMode:a=!1,...s}=e,i=m.useReducer(Ue,{__demoMode:a,menuState:a?0:1,buttonRef:m.createRef(),itemsRef:m.createRef(),items:[],searchQuery:"",activeItemIndex:null,activationTrigger:1}),[{menuState:u,itemsRef:o,buttonRef:n},d]=i,x=z(r);de([n,o],(v,p)=>{var f;d({type:1}),xe(p,ve.Loose)||(v.preventDefault(),(f=n.current)==null||f.focus())},u===0);let h=I(()=>{d({type:1})}),c=m.useMemo(()=>({open:u===0,close:h}),[u,h]),g={ref:x};return q.createElement(J.Provider,{value:i},q.createElement(me,{value:se(u,{0:T.Open,1:T.Closed})},_({ourProps:g,theirProps:s,slot:c,defaultTag:Ke,name:"Menu"})))}let Ge="button";function He(e,r){var a;let s=H(),{id:i=`headlessui-menu-button-${s}`,...u}=e,[o,n]=B("Menu.Button"),d=z(o.buttonRef,r),x=ie(),h=I(f=>{switch(f.key){case b.Space:case b.Enter:case b.ArrowDown:f.preventDefault(),f.stopPropagation(),n({type:0}),x.nextFrame(()=>n({type:2,focus:P.First}));break;case b.ArrowUp:f.preventDefault(),f.stopPropagation(),n({type:0}),x.nextFrame(()=>n({type:2,focus:P.Last}));break}}),c=I(f=>{switch(f.key){case b.Space:f.preventDefault();break}}),g=I(f=>{if(he(f.currentTarget))return f.preventDefault();e.disabled||(o.menuState===0?(n({type:1}),x.nextFrame(()=>{var w;return(w=o.buttonRef.current)==null?void 0:w.focus({preventScroll:!0})})):(f.preventDefault(),n({type:0})))}),v=m.useMemo(()=>({open:o.menuState===0}),[o]),p={ref:d,id:i,type:Ce(e,o.buttonRef),"aria-haspopup":"menu","aria-controls":(a=o.itemsRef.current)==null?void 0:a.id,"aria-expanded":o.menuState===0,onKeyDown:h,onKeyUp:c,onClick:g};return _({ourProps:p,theirProps:u,slot:v,defaultTag:Ge,name:"Menu.Button"})}let Je="div",We=Y.RenderStrategy|Y.Static;function Ye(e,r){var a,s;let i=H(),{id:u=`headlessui-menu-items-${i}`,...o}=e,[n,d]=B("Menu.Items"),x=z(n.itemsRef,r),h=pe(n.itemsRef),c=ie(),g=fe(),v=(()=>g!==null?(g&T.Open)===T.Open:n.menuState===0)();m.useEffect(()=>{let l=n.itemsRef.current;l&&n.menuState===0&&l!==(h==null?void 0:h.activeElement)&&l.focus({preventScroll:!0})},[n.menuState,n.itemsRef,h]),Ne({container:n.itemsRef.current,enabled:n.menuState===0,accept(l){return l.getAttribute("role")==="menuitem"?NodeFilter.FILTER_REJECT:l.hasAttribute("role")?NodeFilter.FILTER_SKIP:NodeFilter.FILTER_ACCEPT},walk(l){l.setAttribute("role","none")}});let p=I(l=>{var M,D;switch(c.dispose(),l.key){case b.Space:if(n.searchQuery!=="")return l.preventDefault(),l.stopPropagation(),d({type:3,value:l.key});case b.Enter:if(l.preventDefault(),l.stopPropagation(),d({type:1}),n.activeItemIndex!==null){let{dataRef:y}=n.items[n.activeItemIndex];(D=(M=y.current)==null?void 0:M.domRef.current)==null||D.click()}le(n.buttonRef.current);break;case b.ArrowDown:return l.preventDefault(),l.stopPropagation(),d({type:2,focus:P.Next});case b.ArrowUp:return l.preventDefault(),l.stopPropagation(),d({type:2,focus:P.Previous});case b.Home:case b.PageUp:return l.preventDefault(),l.stopPropagation(),d({type:2,focus:P.First});case b.End:case b.PageDown:return l.preventDefault(),l.stopPropagation(),d({type:2,focus:P.Last});case b.Escape:l.preventDefault(),l.stopPropagation(),d({type:1}),G().nextFrame(()=>{var y;return(y=n.buttonRef.current)==null?void 0:y.focus({preventScroll:!0})});break;case b.Tab:l.preventDefault(),l.stopPropagation(),d({type:1}),G().nextFrame(()=>{ge(n.buttonRef.current,l.shiftKey?X.Previous:X.Next)});break;default:l.key.length===1&&(d({type:3,value:l.key}),c.setTimeout(()=>d({type:4}),350));break}}),f=I(l=>{switch(l.key){case b.Space:l.preventDefault();break}}),w=m.useMemo(()=>({open:n.menuState===0}),[n]),C={"aria-activedescendant":n.activeItemIndex===null||(a=n.items[n.activeItemIndex])==null?void 0:a.id,"aria-labelledby":(s=n.buttonRef.current)==null?void 0:s.id,id:u,onKeyDown:p,onKeyUp:f,role:"menu",tabIndex:0,ref:x};return _({ourProps:C,theirProps:o,slot:w,defaultTag:Je,features:We,visible:v,name:"Menu.Items"})}let qe=m.Fragment;function Xe(e,r){let a=H(),{id:s=`headlessui-menu-item-${a}`,disabled:i=!1,...u}=e,[o,n]=B("Menu.Item"),d=o.activeItemIndex!==null?o.items[o.activeItemIndex].id===s:!1,x=m.useRef(null),h=z(r,x);U(()=>{if(o.__demoMode||o.menuState!==0||!d||o.activationTrigger===0)return;let y=G();return y.requestAnimationFrame(()=>{var Q,W;(W=(Q=x.current)==null?void 0:Q.scrollIntoView)==null||W.call(Q,{block:"nearest"})}),y.dispose},[o.__demoMode,x,d,o.menuState,o.activationTrigger,o.activeItemIndex]);let c=Se(x),g=m.useRef({disabled:i,domRef:x,get textValue(){return c()}});U(()=>{g.current.disabled=i},[g,i]),U(()=>(n({type:5,id:s,dataRef:g}),()=>n({type:6,id:s})),[g,s]);let v=I(()=>{n({type:1})}),p=I(y=>{if(i)return y.preventDefault();n({type:1}),le(o.buttonRef.current)}),f=I(()=>{if(i)return n({type:2,focus:P.Nothing});n({type:2,focus:P.Specific,id:s})}),w=ke(),C=I(y=>w.update(y)),l=I(y=>{w.wasMoved(y)&&(i||d||n({type:2,focus:P.Specific,id:s,trigger:0}))}),M=I(y=>{w.wasMoved(y)&&(i||d&&n({type:2,focus:P.Nothing}))}),D=m.useMemo(()=>({active:d,disabled:i,close:v}),[d,i,v]);return _({ourProps:{id:s,ref:h,role:"menuitem",tabIndex:i===!0?void 0:-1,"aria-disabled":i===!0?!0:void 0,disabled:void 0,onClick:p,onFocus:f,onPointerEnter:C,onMouseEnter:C,onPointerMove:l,onMouseMove:l,onPointerLeave:M,onMouseLeave:M},theirProps:u,slot:D,defaultTag:qe,name:"Menu.Item"})}let Ze=L(Ve),et=L(He),tt=L(Ye),nt=L(Xe),F=Object.assign(Ze,{Button:et,Items:tt,Item:nt});function vt(){const{setIsPlanOpen:e}=oe(),r=$(c=>c.planOverview),a=$(c=>c.planAction),s=E(c=>c.addConfirmation),i=E(c=>c.setShowConfirmation),u=E(c=>c.environment),o=E(c=>c.environments),{isFetching:n}=ye(),[d,x]=m.useState(!1);m.useEffect(()=>{d&&(h(),x(!1))},[d]);function h(){e(!0)}return t.jsxs("div",{className:"flex items-center",children:[t.jsxs("div",{className:"flex items-center relative",children:[t.jsxs(O,{className:"mx-0 rounded-none rounded-l-lg border-r",variant:A.Alternative,size:N.sm,onClick:c=>{c.stopPropagation(),a.isProcessing?e(!0):u.isProd&&u.isSyncronized?s({headline:"Running Plan Directly On Prod Environment!",description:"Are you sure you want to run your changes directly on prod? Safer choice will be to select or add new environment first.",yesText:`Yes, Run ${u.name}`,noText:"No, Cancel",action(){h()},children:t.jsxs("div",{className:"mt-5 pt-4",children:[t.jsx("h4",{className:"mb-2",children:`${o.size>1?"Select or ":""}Add Environment`}),t.jsxs("div",{className:"flex items-center relative",children:[o.size>1&&t.jsx(ae,{className:"mr-2",side:"left",showAddEnvironment:!1,onSelect:()=>{x(!0),i(!1)},size:N.md,disabled:a.isProcessing}),t.jsx(ue,{className:"w-full",size:N.md,onAdd:()=>{x(!0),i(!1)}})]})]})}):h()},children:[a.isProcessing&&t.jsx(we,{className:"w-3 h-3 mr-1"}),t.jsx("span",{className:"inline-block",children:a.displayStatus(r)})]}),t.jsx(ae,{className:"rounded-none rounded-r-lg border-l mx-0",disabled:n||a.isProcessing||u.isInitialProd})]}),t.jsx(rt,{}),t.jsx(at,{})]})}function rt(){const e=E(a=>a.environment),r=$(a=>a.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[e.isProd?t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-warning-10 text-warning-700  dark:text-warning-400 text-xs text-center",children:"Production"}):e.isDefault?t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:"Default"}):t.jsx(t.Fragment,{}),e.isInitial&&t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-success-10 text-success-500 text-xs text-center font-bold",children:"New"}),e.isSyncronized&&r.isLatest&&t.jsx("span",{className:"block ml-1 px-2 first-child:ml-0 rounded-full bg-neutral-10 text-xs text-center",children:"Latest"}),r.isEmpty&&t.jsx("span",{title:"Need to Re-Run Plan to get latest state",className:"block ml-1 px-2 first-child:ml-0 rounded-full  bg-warning-10 text-warning-700  dark:text-warning-400 text-xs text-center",children:"Unknown"})]})}function at(){const e=$(r=>r.planOverview);return t.jsxs("span",{className:"flex align-center h-full w-full",children:[S(e.added)&&t.jsx(k,{headline:"Added Models",type:j.Add,changes:e.added}),S(e.direct)&&t.jsx(k,{headline:"Direct Changes",type:j.Direct,changes:e.direct}),S(e.indirect)&&t.jsx(k,{headline:"Indirectly Modified",type:j.Indirect,changes:e.indirect}),S(e.metadata)&&t.jsx(k,{headline:"Metadata Changes",type:j.Default,changes:e.metadata}),S(e.removed)&&t.jsx(k,{headline:"Removed Models",type:j.Remove,changes:e.removed}),S(e.backfills)&&t.jsx(k,{headline:"Backfills",type:j.Default,changes:e.backfills})]})}function ae({onSelect:e,disabled:r,side:a=K.Right,className:s,showAddEnvironment:i=!0,size:u=N.sm}){const{addError:o}=oe(),n=E(v=>v.environment),d=E(v=>v.environments),x=E(v=>v.setEnvironment),h=E(v=>v.removeLocalEnvironment),c=Ie(F.Button);function g(v){je(v.name).then(()=>{h(v)}).catch(p=>{o(Pe.Environments,p)})}return t.jsx(F,{children:({close:v})=>t.jsxs(t.Fragment,{children:[t.jsxs(c,{variant:A.Alternative,size:u,disabled:r,className:R(s),children:[t.jsx("span",{className:R("block overflow-hidden truncate",(n.isLocal||r)&&"text-neutral-500",n.isRemote&&"text-primary-500"),children:n.name}),t.jsx("span",{className:"pointer-events-none inset-y-0 right-0 flex items-center pl-2",children:t.jsx(Re,{className:"h-4 w-4","aria-hidden":"true"})})]}),t.jsx(ce,{as:m.Fragment,leave:"transition ease-in duration-100",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:t.jsxs("div",{className:R("absolute top-9 overflow-hidden shadow-xl bg-theme border-2 border-primary-20 rounded-md flex flex-col z-10",a===K.Left&&"left-0",a===K.Right&&"right-0"),children:[t.jsxs(F.Items,{className:"overflow-auto max-h-80 py-2 hover:scrollbar scrollbar--vertical",children:[Array.from(d).map(p=>t.jsx(F.Item,{children:({active:f})=>t.jsxs("div",{onClick:w=>{w.stopPropagation(),x(p),e==null||e()},className:R("flex justify-between items-center pl-2 pr-1 py-1 cursor-pointer overflow-auto",f&&"bg-primary-10",p===n&&"pointer-events-none cursor-default bg-secondary-10"),children:[t.jsxs("div",{className:"flex items-start",children:[t.jsx(Te,{className:R("w-4 h-4 text-primary-500 mt-1.5",f&&"opacity-10",p!==n&&"opacity-0")}),t.jsxs("span",{className:"block",children:[t.jsxs("span",{className:"flex items-center",children:[t.jsx("span",{className:R("block truncate ml-2",p.isRemote&&"text-primary-500"),children:p.name}),t.jsxs("small",{className:"block ml-2",children:["(",p.type,")"]})]}),p.isProd&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Production Environment"})}),p.isDefault&&t.jsx("span",{className:"flex ml-2",children:t.jsx("small",{className:"text-xs text-neutral-500",children:"Default Environment"})})]})]}),t.jsxs("div",{className:"flex items-center",children:[p.isPinned&&t.jsx(Le,{title:"Pinned",className:"w-4 text-primary-500 dark:text-primary-100 mx-1"}),Z(p.isPinned)&&p.isLocal&&p!==n&&t.jsx(O,{className:"!m-0 !px-2 bg-transparent hover:bg-transparent border-none",size:N.xs,variant:A.Neutral,onClick:w=>{w.stopPropagation(),h(p)},children:t.jsx(De,{className:"w-4 text-neutral-500 dark:text-neutral-100"})}),Z(p.isPinned)&&p.isRemote&&p!==n&&t.jsx(O,{className:"!px-2 !my-0",size:N.xs,variant:A.Danger,onClick:w=>{w.stopPropagation(),g(p)},children:"Delete"})]})]})},p.name)),i&&t.jsxs(t.Fragment,{children:[t.jsx(ee,{}),t.jsx(ue,{onAdd:v,className:"mt-2 px-2"})]})]}),t.jsx(ee,{})]})})]})})}function ue({onAdd:e,className:r,label:a="Add",size:s=N.sm}){const i=E(c=>c.getNextEnvironment),u=E(c=>c.isExistingEnvironment),o=E(c=>c.addLocalEnvironment),[n,d]=m.useState(""),[x,h]=m.useState(i().name);return t.jsxs("div",{className:R("flex w-full items-center",r),children:[t.jsx(te,{className:"my-0 mx-0 mr-4 min-w-[10rem] w-full",size:s,children:({className:c})=>t.jsx(te.Textfield,{className:R(c,"w-full"),placeholder:"Environment",value:n,onInput:g=>{g.stopPropagation(),d(g.target.value)}})}),t.jsx(O,{className:"my-0 mx-0 font-bold",size:s,disabled:Ee(n)||u(n),onClick:c=>{c.stopPropagation(),o(n,x),d(""),h(i().name),e==null||e()},children:a})]})}function k({headline:e,type:r,changes:a}){const[s,i]=m.useState(!1);return t.jsx(re,{onMouseEnter:()=>{i(!0)},onMouseLeave:()=>{i(!1)},className:"relative flex",children:()=>t.jsxs(t.Fragment,{children:[t.jsx("span",{className:R("inline-block ml-1 px-2 rounded-full text-xs font-bold text-neutral-100 cursor-default border border-inherit",r===j.Add&&"bg-success-500 border-success-500",r===j.Remove&&"bg-danger-500 border-danger-500",r===j.Direct&&"bg-secondary-500 border-secondary-500",r===j.Indirect&&"bg-warning-500 border-warning-500",r===j.Default&&"bg-neutral-500 border-neutral-500"),children:a.length}),t.jsx(ce,{show:s,as:m.Fragment,enter:"transition ease-out duration-200",enterFrom:"opacity-0 translate-y-1",enterTo:"opacity-100 translate-y-0",leave:"transition ease-in duration-150",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 translate-y-1",children:t.jsx(re.Panel,{className:"absolute right-1 z-10 mt-8 transform flex p-2 bg-theme-lighter shadow-xl focus:ring-2 ring-opacity-5 rounded-lg ",children:t.jsx(ne,{headline:e,type:r,className:"w-full h-full max-w-[50vw] max-h-[40vh] overflow-hidden overflow-y-auto hover:scrollbar scrollbar--vertical",children:t.jsx(ne.Default,{type:r,changes:a})})})})]})})}export{vt as default};
