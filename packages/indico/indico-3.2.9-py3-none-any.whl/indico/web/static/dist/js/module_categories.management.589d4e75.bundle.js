"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[4676],{842:(e,t,n)=>{var a=n(85973),o=n.n(a),r=n(32735),c=n(12788),s=n(72963),i=n(55156),l=n(28995),d=n(17816);!function(e){const t={};function n(e){void 0===t[e]&&(t[e]=e,$.ajax({url:build_url(Indico.Urls.Categories.info,{category_id:e}),dataType:"json",error(e){e.status&&403!==e.status&&handleAjaxError(e)},success(n){t[e]=n}}))}function a(e,t,n){const a=o()(t)?t.category.id:t,r={category_id:e};$("<div>").categorynavigator({category:t,confirmation:!0,openInDialog:!0,actionButtonText:l.$T.gettext("Move here"),dialogTitle:l.$T.ngettext("Move category","Move categories",e.length),dialogSubtitle:l.$T.ngettext("Select new category parent for the category","Select new category parent for {0} selected categories",e.length).format(e.length),actionOn:{categoriesDescendingFrom:{disabled:!0,ids:e},categories:{disabled:!0,groups:[{ids:[a],message:l.$T.ngettext("The category is already here","The selected categories are already here",e.length)},{ids:e,message:l.$T.ngettext("This is the category you are trying to move","This is one of the categories you are trying to move",e.length)}]}},onAction(e){$.ajax({url:n,type:"POST",data:$.extend({target_category_id:e.id},r),error:handleAjaxError,success(e){e.success&&location.reload()}})}})}e.setupCategoryMoveButton=function(e){e&&n(e),$(".js-move-category").on("click",(function(){const n=$(this);a([n.data("categoryId")],t[e],n.data("href"))}))},e.setupCategoryTable=function(e){n(e);const o=$("table.category-management"),r=o.find("tbody"),c=$(".js-bulk-delete-category"),s=$(".js-bulk-move-category"),i="tr[data-category-id]",g="input[name=category_id]";function u(){return r.find(i).map((function(){return $(this).data("category-id")})).toArray()}function h(e){return $.ajax({url:o.data("sort-url"),method:"POST",data:JSON.stringify({categories:e}),dataType:"json",contentType:"application/json",error:handleAjaxError})}function y(e){e?$(".banner .js-delete-category").removeClass("disabled").attr("title",l.$T.gettext("Delete category")):$(".banner .js-delete-category").addClass("disabled").attr("title",l.$T.gettext("This category cannot be deleted because it is not empty."))}function f(){return o.find(i).find(`${g}:checked`).map((function(){return this.value})).toArray()}function m(){return o.find(i).has(`${g}:checked`)}$(".js-sort-categories").on("click",(function(){const e=$(this).data("sort-order"),t=u();!function(e){r.find(i).sort((function(t,n){return[t,n]=[$(t),$(n)],e*function(e,t){const n=(0,d.U)(e.title.toLowerCase(),t.title.toLowerCase());if(0===n)return e.id<t.id?-1:1;return n}({title:t.data("category-title"),id:t.data("category-id")},{title:n.data("category-title"),id:n.data("category-id")})})).detach().appendTo(r)}(e),h(u()),cornerMessage({actionLabel:l.$T.gettext("Undo"),actionCallback:function(){var e;return e=t,$.each(e,(function(e,t){r.find(`[data-category-id=${t}]`).not(".js-move-category").detach().appendTo(r)})),h(t)},feedbackMessage:l.$T.gettext("The category order has been restored."),duration:1e4,message:l.$T.gettext("The category list has been sorted.")})})),s.on("click",(function(n){const o=$(this);n.preventDefault(),o.hasClass("disabled")||a(f(),t[e],o.data("href"))})),o.find(".js-move-category").on("click",(function(){const n=$(this);a([n.data("categoryId")],t[e],n.data("href"))})),o.find(".js-delete-category").on("indico:confirmed",(function(e){e.preventDefault();const t=$(this);$.ajax({url:t.data("href"),method:"POST",error:handleAjaxError,success(e){t.closest(i).remove(),y(e.is_parent_empty)}})})),enableIfChecked(r,g,c,(function(e){return 0===e.filter(":not([data-is-empty=true])").length})),c.on("click",(function(){const e=m();ajaxDialog({url:o.data("bulk-delete-url"),method:"POST",title:l.$T.gettext("Delete categories"),data:{category_id:f()},onClose(t){t&&t.success&&(e.find("input[type=checkbox]").prop("checked",!1),e.remove(),y(t.is_empty))}})})).qtip({suppress:!1,content:{text:function(){const e=m();return e.length?c.hasClass("disabled")?l.$T.gettext("At least one selected category cannot be deleted because it is not empty."):l.$T.ngettext("Delete the selected category","Delete {0} selected categories",e.length).format(e.length):l.$T.gettext("Select the categories to delete first.")}}}),enableIfChecked(r,g,s),s.qtip({suppress:!1,content:{text:function(){const e=m();return e.length?l.$T.ngettext("Move the selected category","Move the {0} selected categories",e.length).format(e.length):l.$T.gettext("Select the categories to move first.")}}}),r.sortable({axis:"y",containment:"parent",cursor:"move",handle:".js-handle",items:"> tr",tolerance:"pointer",update(){h(u())}})},e.setupCategoryEventList=function(e){const t=paginatedSelectAll({containerSelector:"#event-management",checkboxSelector:"input:checkbox[name=event_id]",allSelectedSelector:"input:checkbox[name=all_selected]",selectionMessageSelector:"#selection-message",totalRows:$("#event-management").data("total"),messages:{allSelected:e=>l.$T.ngettext("*","All {0} events in this category are currently selected.").format(e),pageSelected:(e,t)=>l.$T.ngettext("Only {0} out of {1} events is currently selected.","Only {0} out of {1} events are currently selected.",e).format(e,t)}}).isEverythingSelected;n(e),[].forEach.call(document.querySelectorAll(".js-move-event-to-subcategory-container"),(t=>{c.render(r.createElement(s.BN,{eventId:+t.dataset.eventId,currentCategoryId:e,hasPendingMoveRequest:void 0!==t.dataset.pendingRequest,inCategoryManagement:!0}),t)}));const a=document.querySelector("#js-move-events-to-subcategory-container");c.render(r.createElement(s.PZ,{currentCategoryId:e,getEventData:()=>{const e=t(),n=[].map.call(document.querySelectorAll("#event-management input[name=event_id][type=checkbox]:checked"),(e=>e.value));return{allSelected:e,eventIds:e?null:n,eventCount:e?$("#event-management").data("total"):n.length}}}),a),enableIfChecked("#event-management","input[name=event_id]",".js-enabled-if-checked")},e.setupCategoryRolesList=function(){!function(){const e=$("#event-roles");e.on("click",".toggle-members",(function(){const e=$(this).closest("tr").next("tr").find(".slide");e.css("max-height",`${e[0].scrollHeight}px`),e.toggleClass("open close")})),e.on("indico:htmlUpdated",(function(){$(this).find(".slide").each((function(){$(this).css("max-height",`${this.scrollHeight}px`)}))}))}(),$("#event-roles").on("click",".js-add-members",(async e=>{e.stopPropagation();const t=$(e.target),n=await(0,i.showUserSearch)({withExternalUsers:!0});n.length&&$.ajax({url:t.data("href"),method:t.data("method"),data:JSON.stringify({users:n}),dataType:"json",contentType:"application/json",error:handleAjaxError,complete:IndicoUI.Dialogs.Util.progress(),success(e){updateHtml(t.data("update"),e)}})}))}}(window)}},e=>{e.O(0,[5514,3044,8592],(()=>{return t=842,e(e.s=t);var t}));e.O()}]);
//# sourceMappingURL=module_categories.management.589d4e75.bundle.js.map