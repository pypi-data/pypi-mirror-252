{"version":3,"file":"js/module_users.profile_picture.674ca815.bundle.js","mappings":"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","sources":["webpack:///indico/modules/users/client/js/ProfilePicture.jsx"],"sourcesContent":["// This file is part of Indico.\n// Copyright (C) 2002 - 2023 CERN\n//\n// Indico is free software; you can redistribute it and/or\n// modify it under the terms of the MIT License; see the\n// LICENSE file for more details.\n\nimport previewURL from 'indico-url:users.profile_picture_preview';\nimport saveURL from 'indico-url:users.save_profile_picture';\n\nimport createDecorator from 'final-form-calculate';\nimport PropTypes from 'prop-types';\nimport React, {useState, useCallback} from 'react';\nimport ReactDOM from 'react-dom';\nimport {useDropzone} from 'react-dropzone';\nimport {Form as FinalForm, useField, useFormState} from 'react-final-form';\nimport {Button, Form, Icon, Image, Card} from 'semantic-ui-react';\n\nimport {TooltipIfTruncated} from 'indico/react/components';\nimport {FinalSubmitButton} from 'indico/react/forms';\nimport {Translate, Param} from 'indico/react/i18n';\nimport {indicoAxios, handleAxiosError} from 'indico/utils/axios';\n\nimport './ProfilePicture.module.scss';\n\nfunction ProfilePictureCard({image, text, email, children, source}) {\n  const {\n    input: {onChange, value},\n  } = useField('source');\n\n  const active = value === source;\n  return (\n    <Card\n      color={active ? 'blue' : null}\n      onClick={() => onChange(source)}\n      style={active ? {backgroundColor: '#f5f5f5'} : null}\n    >\n      <Card.Description>\n        {image ? (\n          <Image src={image} circular size=\"tiny\" />\n        ) : (\n          <Icon name=\"question circle outline\" size=\"huge\" styleName=\"placeholder\" />\n        )}\n        {text}\n      </Card.Description>\n      {email && (\n        <TooltipIfTruncated useEventTarget>\n          <Card.Content extra>\n            <Translate>\n              Based on <Param name=\"email\" value={email} />\n            </Translate>\n          </Card.Content>\n        </TooltipIfTruncated>\n      )}\n      {children && <Card.Content extra>{children}</Card.Content>}\n    </Card>\n  );\n}\n\nProfilePictureCard.propTypes = {\n  image: PropTypes.string,\n  text: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  children: PropTypes.node,\n  source: PropTypes.oneOf(['standard', 'identicon', 'gravatar', 'custom']).isRequired,\n};\n\nProfilePictureCard.defaultProps = {\n  image: null,\n  email: null,\n  children: null,\n};\n\nfunction CustomPictureUpload({onFileSelected}) {\n  const {submitting} = useFormState({\n    subscription: {submitting: true},\n  });\n\n  const {\n    input: {onChange},\n  } = useField('file', {allowNull: true});\n\n  const {getRootProps, getInputProps, open} = useDropzone({\n    onDropAccepted: ([file]) => {\n      onFileSelected(file);\n      onChange(file);\n    },\n    multiple: false,\n    noClick: true,\n    noKeyboard: true,\n    accept: ['.jpg', '.png', '.gif', '.webp'],\n    disabled: submitting,\n  });\n\n  return (\n    <section>\n      <div {...getRootProps()}>\n        <input {...getInputProps()} />\n        <Button\n          disabled={submitting}\n          type=\"button\"\n          icon=\"upload\"\n          content={Translate.string('Upload')}\n          size=\"small\"\n          onClick={evt => {\n            evt.stopPropagation();\n            open();\n          }}\n        />\n      </div>\n    </section>\n  );\n}\n\nCustomPictureUpload.propTypes = {\n  onFileSelected: PropTypes.func.isRequired,\n};\n\nconst formDecorator = createDecorator({\n  field: 'file',\n  updates: value => (value === null ? {} : {source: 'custom'}),\n});\n\nfunction ProfilePicture({userId, email, source}) {\n  const [previewFile, setPreviewFile] = useState(null);\n  const [hasPreview, setHasPreview] = useState(source === 'custom');\n\n  const userIdArgs = userId !== null ? {user_id: userId} : {};\n\n  const submitPicture = async formData => {\n    const bodyFormData = new FormData();\n    if (formData.source === 'custom') {\n      bodyFormData.append('picture', formData.file);\n    }\n    bodyFormData.append('source', formData.source);\n    const config = {\n      headers: {'content-type': 'multipart/form-data'},\n    };\n    try {\n      await indicoAxios.post(saveURL(userIdArgs), bodyFormData, config);\n    } catch (e) {\n      handleAxiosError(e);\n      return;\n    }\n    location.reload();\n    // never finish submitting to avoid fields being re-enabled\n    await new Promise(() => {});\n  };\n\n  const getPreview = () => {\n    return previewFile\n      ? URL.createObjectURL(previewFile)\n      : previewURL({...userIdArgs, source: 'custom'});\n  };\n\n  const handleFileSelected = useCallback(file => {\n    setPreviewFile(file);\n    setHasPreview(true);\n  }, []);\n\n  const validate = values => {\n    if (values.source === 'custom' && !values.file) {\n      return {source: 'invalid'};\n    }\n    return {};\n  };\n\n  return (\n    <div styleName=\"profile-picture-selection\">\n      <FinalForm\n        onSubmit={submitPicture}\n        initialValues={{file: null, source}}\n        validate={validate}\n        subscription={{}}\n        decorators={[formDecorator]}\n      >\n        {fprops => (\n          <div>\n            <Form onSubmit={fprops.handleSubmit}>\n              <Card.Group itemsPerRow={4} centered>\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'standard'})}\n                  text={Translate.string('System-assigned icon')}\n                  source=\"standard\"\n                />\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'identicon'})}\n                  text=\"Identicon\"\n                  source=\"identicon\"\n                  email={email}\n                />\n                <ProfilePictureCard\n                  image={previewURL({...userIdArgs, source: 'gravatar'})}\n                  text=\"Gravatar\"\n                  source=\"gravatar\"\n                  email={email}\n                />\n                <ProfilePictureCard\n                  image={hasPreview ? getPreview() : null}\n                  text={Translate.string('Custom picture')}\n                  source=\"custom\"\n                >\n                  <CustomPictureUpload onFileSelected={handleFileSelected} />\n                </ProfilePictureCard>\n              </Card.Group>\n              <FinalSubmitButton\n                label={Translate.string('Save changes')}\n                className=\"submit-button\"\n              />\n            </Form>\n          </div>\n        )}\n      </FinalForm>\n    </div>\n  );\n}\n\nProfilePicture.propTypes = {\n  userId: PropTypes.number,\n  email: PropTypes.string.isRequired,\n  source: PropTypes.string.isRequired,\n};\n\nProfilePicture.defaultProps = {\n  userId: null,\n};\n\nwindow.setupPictureSelection = function setupPictureSelection(userId, email, source) {\n  document.addEventListener('DOMContentLoaded', () => {\n    ReactDOM.render(\n      <ProfilePicture userId={userId} email={email} source={source} />,\n      document.querySelector('#profile-picture-selection')\n    );\n  });\n};\n"],"names":["previewURL","_buildFlaskURL","endpoint","rules","args","converters","source","user_id","defaults","trace","data","isDynamic","saveURL","ProfilePictureCard","_ref","image","text","email","children","input","onChange","value","useField","active","React","Card","color","onClick","style","backgroundColor","Image","src","circular","size","Icon","name","className","TooltipIfTruncated","useEventTarget","extra","Translate","Param","CustomPictureUpload","_ref2","onFileSelected","submitting","useFormState","subscription","allowNull","getRootProps","getInputProps","open","useDropzone","onDropAccepted","_ref3","file","multiple","noClick","noKeyboard","accept","disabled","Button","type","icon","content","evt","stopPropagation","propTypes","PropTypes","isRequired","defaultProps","formDecorator","createDecorator","field","updates","ProfilePicture","_ref4","userId","previewFile","setPreviewFile","useState","hasPreview","setHasPreview","userIdArgs","handleFileSelected","useCallback","FinalForm","onSubmit","async","bodyFormData","FormData","formData","append","config","headers","indicoAxios","e","handleAxiosError","location","reload","Promise","initialValues","validate","values","decorators","fprops","Form","handleSubmit","itemsPerRow","centered","_objectSpread","URL","createObjectURL","FinalSubmitButton","label","window","setupPictureSelection","document","addEventListener","ReactDOM","querySelector"],"sourceRoot":""}